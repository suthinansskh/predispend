# การปรับปรุงระบบ - เพิ่มฟิลด์ "ข้อผิดพลาด" (Error Type)

## สรุปการปรับปรุง

### 1. ฟิลด์ใหม่ที่เพิ่ม
- **ข้อผิดพลาด** (Error Type): ฟิลด์ subset ของ "กระบวนการ" ที่จะแสดงตัวเลือกข้อผิดพลาดเฉพาะตามกระบวนการที่เลือก

### 2. การทำงานของระบบ
เมื่อผู้ใช้เลือก "กระบวนการ" ระบบจะแสดงตัวเลือก "ข้อผิดพลาด" ที่เกี่ยวข้อง:

#### กระบวนการจัดยา
- จัดยาผิดชนิด
- จัดยาผิดขนาด
- จัดยาผิดความแรง
- จัดยาผิดปริมาณ
- จัดยาผิดผู้ป่วย
- จัดยาหมดอายุ

#### กระบวนการตรวจสอบ
- ไม่ตรวจสอบ Drug allergy
- ไม่ตรวจสอบ Drug interaction
- ไม่ตรวจสอบขนาดยา
- ไม่ตรวจสอบความถูกต้องของใบสั่งยา
- ตรวจสอบไม่ครบถ้วน

#### กระบวนการจ่ายยา
- จ่ายยาผิดชนิด
- จ่ายยาผิดขนาด
- จ่ายยาผิดผู้ป่วย
- จ่ายยาไม่ครบจำนวน
- จ่ายยาเกินจำนวน
- ไม่ให้คำแนะนำการใช้ยา

#### กระบวนการสั่งยา
- สั่งยาผิดชนิด
- สั่งยาผิดขนาด
- สั่งยาผิดความแรง
- สั่งยาผิดวิธีใช้
- สั่งยาผิดความถี่
- สั่งยาผิดระยะเวลา

#### กระบวนการบริหารยา
- ให้ยาผิดเวลา
- ให้ยาผิดขนาด
- ให้ยาผิดทาง
- ให้ยาผิดผู้ป่วย
- ไม่ให้ยาตามที่สั่ง
- ให้ยาซ้ำ

### 3. การเปลี่ยนแปลงไฟล์

#### predispend.html
1. **เพิ่มฟิลด์ในฟอร์ม**:
   - เพิ่มฟิลด์ `error_type` พร้อม dropdown ที่จะอัปเดตตามกระบวนการที่เลือก
   - เพิ่มฟิลด์ `error_type_other` สำหรับกรอกข้อผิดพลาดอื่นๆ

2. **JavaScript Logic**:
   - เพิ่ม `processErrorMapping` object สำหรับ mapping กระบวนการ → ข้อผิดพลาด
   - อัปเดต event listener ของ `process` select เพื่ออัปเดต `error_type` dropdown
   - เพิ่ม validation สำหรับฟิลด์ `error_type` ใน form submission
   - อัปเดต data submission เพื่อส่งข้อมูล `ข้อผิดพลาด`

3. **Dashboard**:
   - เพิ่มกราฟแสดงสถิติข้อผิดพลาด (`errorTypeChart`)
   - อัปเดต data aggregation เพื่อรวบรวมข้อมูล `byErrorType`

4. **Records List**:
   - เพิ่มคอลัมน์ "ข้อผิดพลาด" ในตารางแสดงรายการบันทึก
   - อัปเดต colspan จาก 8 เป็น 9 สำหรับกรณีไม่มีข้อมูล

5. **Form Reset**:
   - อัปเดตฟังก์ชัน reset เพื่อรีเซ็ตฟิลด์ `error_type` และ `error_type_other`

#### GoogleAppsScript.js
1. **การ validation**:
   - เพิ่ม `ข้อผิดพลาด` ในรายการ required fields
   - เพิ่ม detailed logging สำหรับ debugging
   - ปรับปรุง error handling และ validation

2. **การจัดการข้อมูล**:
   - ระบบใช้ dynamic header mapping จึงรองรับฟิลด์ใหม่โดยอัตโนมัติ
   - เพิ่ม logging เพื่อช่วยในการติดตาม data mapping

### 4. การตั้งค่า Google Sheets
ต้องเพิ่มคอลัมน์ "ข้อผิดพลาด" ใน Google Sheets ในตำแหน่งที่เหมาะสม (แนะนำหลังคอลัมน์ "กระบวนการ")

### 5. การทดสอบ
1. ทดสอบการเลือกกระบวนการต่างๆ และตรวจสอบว่า dropdown ข้อผิดพลาดอัปเดตถูกต้อง
2. ทดสอบการเลือก "อื่นๆ" ในทั้งกระบวนการและข้อผิดพลาด
3. ทดสอบการบันทึกข้อมูลและตรวจสอบใน Google Sheets
4. ทดสอบการแสดงข้อมูลใน Dashboard และ Records List
5. ทดสอบฟังก์ชัน Reset Form

### 6. ประโยชน์ของการปรับปรุง
- **ความละเอียดมากขึ้น**: สามารถระบุข้อผิดพลาดเฉพาะได้แม่นยำขึ้น
- **การวิเคราะห์ที่ดีขึ้น**: Dashboard สามารถแสดงสถิติข้อผิดพลาดแยกตามประเภท
- **ความสะดวกในการใช้งาน**: ระบบจะแสดงเฉพาะข้อผิดพลาดที่เกี่ยวข้องกับกระบวนการที่เลือก
- **ความครบถ้วน**: ครอบคลุมข้อผิดพลาดในทุกกระบวนการหลักของการจัดการยา

### 7. หมายเหตุ
- ระบบยังคงรองรับการเลือก "อื่นๆ" ทั้งในกระบวนการและข้อผิดพลาด
- ข้อมูลเก่าที่ไม่มีฟิลด์ข้อผิดพลาดจะแสดงเป็นช่องว่าง
- การ validation ต้องการให้เลือกข้อผิดพลาดก่อนส่งฟอร์ม
